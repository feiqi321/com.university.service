<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ovft.configure.sys.dao.QuestionSearchMapper" >
     <!--添加问卷调查主题-->
     <insert id="createSearchQuestion" parameterType="com.ovft.configure.sys.bean.SearchQuestion" useGeneratedKeys="true"
             keyProperty="sid">
       insert  into  edu_search_question(sid,schoolId,search_name,content,createtime,updatetime,
       endtime,schoolName,author,top_image,tid) values (default,#{schoolId},#{searchName},#{content},#{createTime},
       #{updateTime},#{endTime},#{schoolName},#{author},#{topImage},#{tid})
     </insert>
    <!--添加问卷题目-->
    <insert id="createQuestion" parameterType="com.ovft.configure.sys.bean.Question">
       insert  into  edu_question_item(qid,sid,question,answer) values (default,#{sid},#{question},#{answer})
     </insert>
     <!--添加问卷题目选项-->
     <insert id="createQuestionItem" parameterType="com.ovft.configure.sys.bean.QuestionItem" useGeneratedKeys="true"
             keyProperty="sid">
       insert  into  edu_question_item(id,qid,Item_char,content,sid,num) values (default,#{qid},#{itemChar},#{content},#{sid},#{num})
     </insert>
    <!--批量添加问卷题目及选项记录-->
    <insert id="insertBigQuestionItem" parameterType="java.util.List" useGeneratedKeys="false">
        insert into edu_question
        (qid,sid,question,item1,item1_num,item1_grade,item2,item2_num,item2_grade,item3,item3_num,item3_grade,item4,item4_num,item4_grade,
        item5,item5_num,item5_grade,item6,item6_num,item6_grade)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.qid},
            #{item.sid},
            #{item.question},
            #{item.item1},
            #{item.item1_num},
            #{item.item1_grade},
            #{item.item2},
            #{item.item2_num},
            #{item.item2_grade},
            #{item.item3},
            #{item.item3_num},
            #{item.item3_grade},
            #{item.item4},
            #{item.item4_num},
            #{item.item4_grade},
            #{item.item5},
            #{item.item5_num},
            #{item.item5_grade},
            #{item.item6},
            #{item.item6_num},
            #{item.item6_grade}
            )
        </foreach>
    </insert>

    <!--删除对应问卷主题记录-->
    <delete id="deleteSearchQuestion" parameterType="int">
           delete from  edu_search_question where sid=#{sid}
    </delete>

     <!--删除对应问卷的题目及选项-->
    <delete id="deleteQuestionItem" parameterType="int">
           delete from  edu_question where sid=#{sid}
    </delete>

    <!--后台条件查询问卷调查-->
    <select id="findSearchQuestionAll"  resultType="com.ovft.configure.sys.bean.SearchQuestion">
        select s.sid, s.schoolId, s.search_name as searchName,s.content,s.createtime, s.updatetime,s.endtime,s.schoolName,
         s.top_image as topImage,s.author,s.tid
        from edu_search_question s

        where 1=1
        <if test="sid != null and sid != ''">
            AND s.sid = #{sid}
        </if>
        <if test="schoolId != null and schoolId != ''">
            AND s.schoolId = #{schoolId}
        </if>
        <if test="tid != null and tid != ''">
            AND s.tid = #{tid}
        </if>
        <!--<if test="type != null and type != ''">-->
            <!--AND a.type = #{type}-->
        <!--</if>-->
        <if test="search != null and search != ''">
            AND (s.searchName  like CONCAT('%',#{search},'%')  or s.author like CONCAT('%',#{search},'%'))
        </if>

        ORDER BY s.createtime DESC,s.updatetime DESC
    </select>
    <select id="findQuestionAll"  resultType="com.ovft.configure.sys.bean.Question">
        select q.qid,q.question,q.item1,q.item1_num,item1_grade,q.item2,q.item2_num,item2_grade
        ,q.item3,q.item3_num,item3_grade,q.item4,q.item4_num,item4_grade,q.item5,q.item5_num,item5_grade,q.item6,q.item6_num,item6_grade,q.tid
        from edu_question q

        where 1=1
        <if test="sid != null and sid != ''">
            AND q.sid = #{sid}
        </if>

        <if test="tid != null and tid != ''">
            AND q.tid = #{tid}
        </if>
        <!--<if test="type != null and type != ''">-->
        <!--AND a.type = #{type}-->
        <!--</if>-->
        <if test="search != null and search != ''">
            AND (s.searchName  like CONCAT('%',#{search},'%')  or s.author like CONCAT('%',#{search},'%'))
        </if>

    </select>



</mapper>
